# Robot Structure
In this example, we will create the simplest "2-bar" robot example. As the name suggests, it consists of two links and two actuators.

<figure markdown="span">
    ![alt text](<images/two_bar.png>)
    <figcaption>Conceptual Image of a 2-Bar Robot</figcaption>
</figure>

First, navigate to the **Home** screen and click **Create New Robot**. 

<figure markdown="span">
    ![create_robot](images/create_new_robot1.png){ width="1000" }
    <figcaption>Navigate to the Home screen and click the <strong>Create New Robot</strong> button</figcaption>
</figure>

The following screen will appear. Select **EmptyRobot** and enter your desired robot name. In this example, we named it `test_robot`. Click **Create** to move to the robot editing window.

<figure markdown="span">
    ![create_robot](images/create_new_robot2.png){ width="1000" }
    <figcaption>Select <strong>EmptyRobot</strong>, enter the name <code>test_robot</code>, and click Create</figcaption>
</figure>

---

## 1. Robot Structure Setup
First, we will construct the skeleton of the robot.

### 1. Adding Joints
- Click the `+` button on the right side of the **Joint Section** to add a joint.
- You can continue adding joints as needed, but for non-`None` type joints, you can add up to a maximum of **7 axes**.

### 2. Setting DH Parameters (Link 1)
Enter the parameters as follows:

| Parameter | Value | Unit |
|:---:|:---:|:---:|
| **theta** ($\theta$) | 90 | deg |
| **d** | 0 | mm |
| **a** | 300 | mm |
| **alpha** ($\alpha$) | 0 | mm |

By doing this, a link extended 300mm along the Y-axis relative to the Base Coordinate System (the initial World Coordinate System) will be drawn, as shown in the picture below.

<figure markdown="span">
    ![create_robot](images/creation_link1.png){ width="1000" }
    <figcaption>Creation of Link 1</figcaption>
</figure>

- Setting the **Joint Type** to `Rotation Z` indicates that it rotates around the Z-axis of the previous coordinate system.

### 3. Adding the Second Link
Add another link. Set `a` to **300**, leave the others at **0**, and set the rotation to `Rotation Z`.

<figure markdown="span">
    ![create_robot](images/creation_link2.png){ width="1000" }
    <figcaption>Creation of Link 2</figcaption>
</figure>

### 4. Jogging and Testing
Once the skeleton is built, you can use the **Jog** button to check if the rotation direction is correct or to move it slightly for testing.

<figure markdown="span">
    ![jog_control](images/jog_button.png)
    <figcaption>Jog Control Interface</figcaption>
</figure>

- **Jog**: Moves the robot.
- **Jog Reset**: Returns the moved robot to its origin.

With this, we have constructed the robot's skeleton using DH parameters.

---

## 2. Dynamics Settings
Next, let's configure the robot's dynamics. Clicking **Dynamics** in each Joint Section allows you to configure the dynamics settings for the link connecting that joint's coordinate system to the coordinate system offset by its DH parameters (Advanced settings appear on the right).

> **Note:** This link is indicated in blue on the 3D model. Conversely, clicking the link part of the 3D model will also display the corresponding tab on the right.

### Definition of Coordinate Systems
To accurately configure the settings below, we first need to define the **Output Coordinate System**. This refers to the coordinate system advanced by the DH parameters from the current joint's coordinate system. 

Please refer to the diagrams below showing the **Output Coordinate System** for each link.

<figure markdown="span">
    ![create_robot](images/link1_output_coord.png)
    <figcaption>Link 1 Output Coordinate System</figcaption>
</figure>

<figure markdown="span">
    ![create_robot](images/link2_output_coord.png)
    <figcaption>Link 2 Output Coordinate System</figcaption>
</figure>

### 1. Mass
This refers to the mass of the corresponding link.
- Input the mass of the link physically connecting the **Current Joint Coordinate System** to the **Next Joint Coordinate System**.
- Typically, you derive the physical properties from the CAD file by measuring the mass between the output stage (after the reducer) of the current joint and the output stage of the next joint.

### 2. Center of Mass (CoM)
The Center of Mass must be defined relative to a specific reference frame.
- The reference is the **Output Coordinate System** defined above (the frame advanced by the DH parameters).
- Enter the center of mass of the link relative to this **Output Coordinate System**.
- This can be obtained by defining a coordinate system in a CAD program (like SolidWorks) and calculating the center of mass coordinates based on it.

### 3. Rotational Inertia
- The reference coordinate system for inertia is centered at the **Center of Mass**.
- The orientation of its coordinate vectors (Rotation) must match the **Output Coordinate System**.
- This value is also typically derived via CAD software.

For this 2-bar example, since it is virtual, we have entered approximate values as shown below.

<figure markdown="span">
    ![create_robot](images/link1_cog.png){ width="1000" }
    <figcaption>Link 1 Inertia Settings & Reference Coordinate System</figcaption>
</figure>

<figure markdown="span">
    ![create_robot](images/link2_cog.png){ width="1000" }
    <figcaption>Link 2 Inertia Settings & Reference Coordinate System</figcaption>
</figure>

---

## 3. Constraints
Now that the robot's inertial information has been entered, let's input the detailed limit values and parameters for each joint. These settings are crucial for the safety.

To access these settings, click the **Constraints** button in the Joint Section as shown below. This will open the configuration panel on the right side of the screen. You will notice that the selected joint is highlighted in the 3D model to indicate which part you are editing. Conversely, clicking a joint directly within the 3D model will also open the corresponding editing panel.

<figure markdown="span">
    ![constraints](images/constraints.png)
    <figcaption>Constraints Configuration Panel</figcaption>
</figure>

The specific parameters available in this section are defined as follows:

### 1. Joint Limits
Joint limits serve as **software-defined boundaries**. If a target joint position **falls outside the range defined by the Lower Limit and Upper Limit**, control will stop **immediately** to prevent unsafe motion.

### 2. Kinematic Limits
This section defines the kinematic constraints for the joint, including maximum speed, acceleration, and jerk.

> ⚠️ **Important Note on Units**
> Units may vary depending on the joint type:
> - For **revolute joints**: typically in degrees (°), deg/s, deg/s², etc.
> - For **prismatic joints**: typically in millimeters (mm), mm/s, mm/s², etc.

Define these limits based on the **final actuator-level constraints**, taking into account motor specifications, gear reduction ratios, and other mechanical characteristics.

* **Max Speed**: The maximum speed allowed during motion **toward the current target**.
* **Max Acceleration**: The maximum acceleration allowed **while moving toward the current target**.
* **Max Jerk**: The maximum jerk (rate of change of acceleration) allowed during target-directed motion.

### 3. Friction Parameters
This defines the **joint friction model**, assuming that friction is purely a function of joint velocity. The friction output from this model is always bounded within the range: `-Max Friction ≤ τ_friction ≤ Max Friction`.

**Model Description**
As shown in the diagram below:
- When `-w1 < w < w1`, the friction curve follows a **smooth quadratic transition**.
- When `|w| > w1`, the function transitions into **linear segments**.
- The entire curve is modeled as an **origin-symmetric function**.

<figure markdown="span">
    ![constraints](images/friction_parameter.png)
    <figcaption>Friction Model Curve</figcaption>
</figure>

The curve is defined by three key parameters:
1.  **Low-speed point (`w1`, `f1`)**: `w1` is the low velocity threshold (deg/s or mm/s), and `f1` is the corresponding friction torque/force (Nm or N).
2.  **High-speed point (`w2`, `f2`)**: `w2` is the high velocity threshold, and `f2` is the corresponding friction torque/force.
3.  **Maximum Friction**: The upper bound for the friction output (Nm or N).

### 4. Collision Threshold
Defines the **default torque/force threshold** for detecting collisions on this joint.

- If the **estimated external force or torque** on the joint **exceeds this threshold**, a **collision detection error** will be triggered immediately to ensure safety.
- **Unit**: Nm (for revolute joints) or N (for prismatic joints).

> ⚠️ Set this value carefully based on your system’s environment and sensitivity requirements.

### 5. Goal Tolerance
**Goal Joint Tolerance** serves as the threshold for determining whether the robot has successfully reached its target when executing **joint space commands** (e.g., `move_joint`).

- If the difference between the current joint position and the target position falls within this value, the motion is considered complete.
- **Revolute Joints:** The value is typically in **degrees** or **radians**.
- **Prismatic Joints:** The value is typically in **millimeters** or **meters**.

> ⚠️ **Caution:** Pay close attention to the **units**, which depend on the type of joint.

---

### Configuration Example
For this example, please configure the constraints for each joint using the values shown in the screenshots below:

<figure markdown="span">
    ![constraints](images/joint1_constraints.png)
    <figcaption>Constraints Settings for Joint 1</figcaption>
</figure>

<figure markdown="span">
    ![constraints](images/joint2_constraints.png)
    <figcaption>Constraints Settings for Joint 2</figcaption>
</figure>

## 4. Summary
In this chapter, we covered the process of:
1. Constructing the robot skeleton using **DH Parameters**.
2. Setting **Inertia/Physical Properties** for each link, paying close attention to the **Output Coordinate System**.
3. Configuring detailed **Limits and Constraints** (Kinematic limits, Joint limits, Friction models, etc.)

These steps cover the settings for individual joints and links. In the next section, we will proceed with configuring the overall parameters for the constructed robot.